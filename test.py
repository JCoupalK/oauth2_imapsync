import imaplib
import base64

# IMAP server for Office365
IMAP_SERVER = "outlook.office365.com"
IMAP_PORT = 993  # SSL port for IMAP
OAUTH_TOKEN = "eyJ0eXAiOiJKV1QiLCJub25jZSI6IkZFOTN1VG5rSE5fWTFXZnBzM0FoN1dtdmV2MndMQjNPS3NLd1FoUHEteTAiLCJhbGciOiJSUzI1NiIsIng1dCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyIsImtpZCI6InoxcnNZSEhKOS04bWdndDRIc1p1OEJLa0JQdyJ9.eyJhdWQiOiJodHRwczovL291dGxvb2sub2ZmaWNlMzY1LmNvbSIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0L2EzNWE2MzY2LWFkZjEtNDg2OC1hMDQyLThhNGU1NTg3N2JjYi8iLCJpYXQiOjE3MzY0Nzg5NDgsIm5iZiI6MTczNjQ3ODk0OCwiZXhwIjoxNzM2NDgyODQ4LCJhaW8iOiJrMkJnWURqVDdEUTc0NkxwZWduZnJ6OFNYMnB2QUFBPSIsImFwcF9kaXNwbGF5bmFtZSI6IklNQVAiLCJhcHBpZCI6IjYwZDdlMWRjLTU3ZGEtNGRhOC04ZWMzLTYwYWQwN2U4MjA5ZCIsImFwcGlkYWNyIjoiMSIsImlkcCI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0L2EzNWE2MzY2LWFkZjEtNDg2OC1hMDQyLThhNGU1NTg3N2JjYi8iLCJpZHR5cCI6ImFwcCIsIm9pZCI6IjI2YmM4Yzc2LThhOTMtNDk4Zi1hZWVlLWUxY2E0NzkyMmFjYyIsInJoIjoiMS5BVkFBWm1OYW9fR3RhRWlnUW9wT1ZZZDd5d0lBQUFBQUFQRVB6Z0FBQUFBQUFBQl9BQUJRQUEuIiwicm9sZXMiOlsiUE9QLkFjY2Vzc0FzQXBwIiwiSU1BUC5BY2Nlc3NBc0FwcCIsIlNNVFAuU2VuZEFzQXBwIl0sInNpZCI6IjY4ZGYxYTI3LTBkNTQtNDA5NS1iZjE5LTYwYzcwNzFiY2I2NyIsInN1YiI6IjI2YmM4Yzc2LThhOTMtNDk4Zi1hZWVlLWUxY2E0NzkyMmFjYyIsInRpZCI6ImEzNWE2MzY2LWFkZjEtNDg2OC1hMDQyLThhNGU1NTg3N2JjYiIsInV0aSI6IlFkdWtFLUR5SzBlcDZ5enQ4YUFiQUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbIjA5OTdhMWQwLTBkMWQtNGFjYi1iNDA4LWQ1Y2E3MzEyMWU5MCJdLCJ4bXNfYXVkX2d1aWQiOiIwMDAwMDAwMi0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAiLCJ4bXNfaWRyZWwiOiI3IDI0IiwieG1zX3JkIjoiMC40MkxsWUJKaURBQUEifQ.Xv6i9gFyd3mfbytU4d1W9gscTjCtlfUqmey-XAQyj81LDTHrn7Yol5jQmJpsCA__4QyeXKjyaeKhSH9hXutPQ4DO6rvYia1cRhs9zgkz4mf9n6Z7DDXfSW7K7dYvgl5Ca2hWDUSZbmMHMDN6LPPxktfN335CfBoyAuYVj79EbtLYJ1EKAp5IuQb90LCUHelm24zlQNdfiuFGkODDs4nLoF6sH2NutfW-rADCg_AfeHnIp-QUrHt3kskp-d-YUXDe0NklzNnObBX3F22uYHZeAJG5w9I9rw7dl4if9uFXN_PBJjgrjHtvkt0D7PCPananO72dd_ebW4wGfWfMCORAdQ"

# Create an IMAP4_SSL connection
mail = imaplib.IMAP4_SSL(IMAP_SERVER, IMAP_PORT)

# Authenticate using the OAuth token
mail.authenticate(
    'XOAUTH2', lambda x: f"user={x}\x01auth=Bearer {OAUTH_TOKEN}\x01\x01".encode("utf-8"))

# List mailboxes (folders)
status, mailboxes = mail.list()
if status == 'OK':
    print("Mailboxes:")
    for mailbox in mailboxes:
        print(mailbox.decode("utf-8"))

# Don't forget to logout after the operation
mail.logout()
